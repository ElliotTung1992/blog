#### 限流

---

##### 什么是QPS

每秒查询率（QPS, Queries-per-second）, 即单位时间单位计算资源处理的请求数据量.

在大模型场景下, QPS的提升意味着模型推理速度的提高, 这能够为更多用户提供服务或降低模型推理的成本.

##### 常见的解决方案

1. 固定窗口算法
2. 滑动窗口算法
3. 滑动日志算法
4. 漏桶算法
5. 令牌流算法

##### 常见的解决方案比较

窗口算法: 

1. 算法实现简单
2. 逻辑清晰
3. 可以直观地了解当前的QPS情况
4. 有时间窗口的临界突变问题
5. 不像桶一样有队列可以缓冲

桶算法:

1. 主要使用生产者和消费者模型
2. 不好统计QPS情况
3. 漏桶模式 - 消费速率恒定, 可以很好地保护自身系统, 面对突发流量不能快速响应.
4. 令牌桶模式 - 可以面对突发流量, 但是启动会有缓慢加速过程.

#### 限流算法

---

##### 固定窗口算法

问题: 时间窗口的临界突变

##### 滑动窗口算法

问题: 解决了时间窗口的临界突变, 但是逻辑比较复杂

##### 滑动日志算法

问题: 逻辑比较简单, 但是比价占内存

##### 漏桶算法



##### 令牌桶算法

#### 限流算法实现

---

##### 单机版限流 - Guava中的限流工具类RateLimiter

使用令牌桶算法实现

##### Redis分布式限流 - 固定窗口算法

使用Redis的`incr`和设置key的过期时间

##### Redis分布式限流 - 滑动窗口算法

使用Redis的`ZSET`命令实现Redis的滑动窗口算法

##### Sentinel



















