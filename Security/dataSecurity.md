#### 常见的数据安全问题



#### 数据加密基本概念

---

##### 对称加密

采用单钥密码系统的加密方式, 同一个密钥可以同时用作信息的加密和解密, 这个加密方式称为对称加密, 也称为单密钥加密.

##### 公钥加密/非堆成加密

公钥加密, 也叫非对称(密钥)加密, 指的是由对应的一对唯一性密钥(即公开密钥和私有密钥)组成的加密方法.

它解决了密钥的发布和管理问题, 是商业密码的核心.

在公钥加密体制中, 没有公开是私钥, 公开的公钥.

##### 不可逆加密算法/单向加密算法

不可逆加密算法的特征是加密过程中不需要使用密钥, 输入明文后由系统直接经过加密算法处理成密文, 

这种加密后的数据是无法被解密的, 只有重新输入明文, 并再次经过同样不可逆的加密算法处理，得到相同的加密密文并被系统重新识别后，才能真正解密.



#### 数据隔离

---

##### 机构数据隔离

一个大企业下可能存在多个机构, 如总行, 分行等

##### 部门数据隔离

一家公司可能存在多个部门, 如: 人事部, 开发部, 后勤部等

##### 权限数据隔离

不同的人员有不同的权限, 如: 董事长, 部门经理, 小组长和普通员工



#### 数据加密算法

---

##### jasypt

jasypt实现yml文件中敏感信息的加密处理

##### AES - 对称加密

密码学中的高级加密标准(Advanced Encryption Standard)

1. 安全性高 - AES算法是一种可靠的加密算法.
2. 效率高 - AES算法采用对称加密算法进行加密和解密, 所以效率更高.
3. 使用广泛 - 在多个领域有广泛的使用

##### MD5 - 不可逆加密算法

1. 压缩性 - 任意长度的数据, 算法的MD5值长度都是固定的
2. 容易计算 - 从原始数据计算出MD5值很容易
3. 抗修改性 - 对原数据进行任何改动, 哪怕只修改一个字节, 所得到的MD5值都有很大的区别
4. 抗碰撞性 - 找到两个不同的输入产生相同的输出的概率极低, 这使得SHA256在密码学应用中非常安全.

##### SHA256 - 不可逆加密算法

SHA256算法使用的哈希值长度是256位.

SHA256是一种密码散列函数, 属于SHA-2算法簇中的一种.

SHA256算法的特点:

1. 确定性 - 对于相同的输入, SHA256总能产生相同的输出
2. 单向函数 - SHA256是一个单向函数, 意味着从输出(哈希值)反向推导出原始输入(消息)在计算中是不可行的.
3. 抗碰撞性 - 找到两个不同的输入产生相同的输出的概率极低, 这使得SHA256在密码学应用中非常安全.

##### RSA算法 - 非堆成算法

RSA算法是一种非对称加密算法, 与对称加密算法不用的是, RSA算法有两个不同的密钥, 一个是公钥, 一个是私钥.

公钥加密 - 私钥解密

私钥签名 - 公钥

RSA算法的特点:

1. 非对称性: RSA算法使用一对公钥和私钥
2. 安全性: RSA的安全性基于大素数的难解性, 即大整数分解问题
3. 广泛适用性: RSA算法广泛用于数字签名、数据加密、密钥交换等领域
4. 效率相对较低: 由于涉及大数运算, RSA算法相对于对称加密算法而言, 加解密速度较慢.
5. 公开算法: RSA加密算法公开, 任何人都可以使用和研究该算法, 便于广泛应用和发展.
6. 可以进行密钥交换: RSA算法可以用于密钥交换, 例如TLS/SSL协议就采用了RSA算法进行密钥交换
7. 可以进行分布式加密: RSA算法可以实现分布式加密, 即加密和解密可以在不同的计算机上进行.

##### 加密使用场景

1. Git - RSA算法
2. 和外部系统交互
3. JWT签名验签



#### 数据权限问题

---

##### 接口数据返回未按最小维度设置

假设一个接口返回的数据有10个字段

场景A需要8个字段: 则只返回8个字段；错误案例全量返回

场景B需要6个字段: 则只返回6个字段；错误案例全量返回

##### 未对数据的所属人进行校验

通过主键查询一条数据，未对这条数据的所属人进行限制查询

如一条数据的主键是1，所属人手机号是139

直接通过主键1查询未同步加上当前登陆人的手机号

存在数据越权风险



#### 数据脱敏

---

##### 数据库数据脱敏

mysql实现方案:

```
使用concat(str1, str2,...), left(str, len), right(str, len)函数:
select concat(left('field', len), '***', right('field', len)) from 'table';

使用insert(str, pos, len, newstr)函数:
select insert('field', pos, len, newstr) from 'table';
```

oracle实现方案:

```
使用replace('field', 'str1', 'str2')函数和subStr(str, pos, len)函数
select replace('field', substr('field', pos, len), '***') from 'table';
```

数据脱敏场景：

1. 用户手机号脱敏
2. 用户身份证脱敏
3. 用户姓名脱敏



#### 数据编码解码

---

##### Base64实现编码解码

Java实现Base64

```
    public static String encode(String blankText){
        return  Base64.getEncoder().encodeToString(blankText.getBytes(StandardCharsets.UTF_8));
    }
    public static String encode(byte[] blankByte){
        return Base64.getEncoder().encodeToString(blankByte);
    }
    public static String decode(String encodeText){
        byte[] byte1 = Base64.getDecoder().decode(encodeText);
        return new String(byte1,StandardCharsets.UTF_8);
    }
    public static String decode(byte[] encodeByte){
        return new String(encodeByte,StandardCharsets.UTF_8);
    }
```



#### SQL注入

---

##### SQL注入案例

select * from QRTZ_LOCKS where SCHED_NAME = 'clusteredScheduler' and LOCK_NAME = 'STATE_ACCESS';

select * from QRTZ_LOCKS where SCHED_NAME = 'clusteredScheduler' or 1=1 --'  and LOCK_NAME=123456';

##### 什么是SQL注入

SQL注入(英文: SQL injection), 也称SQL注入或SQL注码, 是发生于应用程序和数据库层的安全漏洞. 简而言之, 是在输入的字符串之中注入了sql指令, 在设计不良的程序当中忽视了字符串检查, 那么这些注入进去的恶意指令就会被数据库服务器误认为是正常的SQL指令而执行, 因此遭到破坏或是入侵.

##### 防止SQL注入的方法

1. 使用RreparedStatement
2. 使用正则表达式或字符串过滤器对入参进行校验
3. 如果使用Mybatis框架不是特殊情况使用#{}而不是${}



#### 越权

---

越权, 指执行超出其权限范围的操作. 主要包括水平越权和垂直越权.

##### 水平越权

水平越权指相同权限的不同用户可以互相访问和操作, 比如普通用户A可以看到普通用户B的数据

##### 垂直越权

垂直越权是指低权限用户可以访问高权限用户功能, 比如普通用户A可以看到系统管理员才能看到的数据

##### 案例：

1. 报表导出和数据列表未根据当前用户的角色部门等信息进行数据过滤, 导致发生越权
1. 对数据进行查询和操作时只使用主键进行约束
1. 返回过多的数据: 如参与组团活动，把活动其它成员的信息也进行返回



#### 文件

---

常见的非法上传文件类型: 

1. sh
2. html
3. jsp

##### 案例：

1. 未对上传的文件进行文件格式约束

















