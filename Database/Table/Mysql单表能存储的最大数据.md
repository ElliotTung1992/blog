#### MySql单表能存储的最大数据

---

1. MySql索引的数据结构 - B+树
2. MySql数据的存储结构 - 页

##### 单表最大能存储多少数据:

数据库字段有不同的类型, 不同的数据类型占用的数据大小不一样.

数据库主键是自增的, 那是不是主键类型对应的大小的最大值是不是表能存储的最大数据.

主键类型为tinyint类型时: 主键大小为8位, 范围(-128, 127) 

主键类型为int类型时: 主键大小为32位, 范围(2^32-1)



#### 数据储存结构

---

##### 数据存储结构

InnoDB会为每个表生成两个文件：

1. frm文件: 表结构数据
2. ibd文件: 数据文件(聚簇索引包含数据和索引), 又称为表空间.

我们表中的数据其实都是存储在磁盘.idb文件中, 而每次读取整个.idb文件无疑是非常慢的.

所以InnoDB将数据划分为若干个页, 以页错位磁盘和内存之间交互的基本单位, InnoDB中页的大小一般为16KB.

一个.idb文件是由多个数据页组成的, 也就是说一个表的数据会被分散在多个数据页中.

数据页中还存储了除数据之外的东西, 比如数据页的前后指针, 页号, 页目录等, 因此虽然一个数据页虽然一共16KB, 但是能够用来存储数据的其实是不足16KB.

通过页的组成, 我们可以大致分析在数据页中一下查找数据的整体过程:

1. 记录被分散在不同的数据页中, InnoDB通过【页号】来标识数据具体在哪一页
2. 不同的数据页之间使用【前后指针】进行关联, 避免检索消耗
3. 当找到数据的那个数据页之后, InnoDB为避免遍历检索而提供了一个【页目录】, 页目录通过**「二分查找」**将查找效率**「从O(n) 变成O(lgn)」**，从而快速定位数据的位置

##### 索引存储结构

既然在.idb文件中只要知道了页号, 就可以快速定位到数据行的位置, 从而读取到响应的数据.

如何知道页号, 无非就两种方式:

1. 全表扫描
2. 通过索引找到数据页

InnoDB索引是基于B+Tree实现的, InnoDB在构建B+tree结构时, 一般会找出每个数据页中id最小的记录与其对应的页号.

将Id与页号组成一个新的记录, 存储在一个新生成的数据页中, 其大小也为16K, 为与存储数据的数据页区分, 引入了数据页之间的上下层级关系, 也就是页层级.

B+tree中分为两个部分:

1. 叶子结点: 真正存放表中的数据的数据页
2. 非叶子结点: 存放索引以及索引对应数据所在的页号的数据页

我们知道数据页之间是有地址指向的, 如果要找一条数据, 需要经过三次磁盘IO就可以将数据页都加载到内存中, 从而找到数据完成查询.

##### B+Tree能存储多少数据

要知道一个B+Tree能存多少数据并不难,B+Tree中的叶子结点存放是数据, 而一个数据页只有16K, 假设一个数据页中15K用来存储数据, 每条数据的大小是1K. 就能大概算出一颗3层的B+Tree大概能存储多少的数据.

##### 什么时候存储的数据能超过2000W的数据

当一行的数据非常小, 仅仅只占用100KB.

##### 总结

除了主键的大小和磁盘的限制, 最重要的就是索引的结构, 即B+Tree. 

​              



















